{
    "sourceFile": "src/pages/TableauUtilisateur.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1750178163349,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1750178169337,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n       case 'reservations':\r\n         return <MesReservations onError={setGlobalError} />;\r\n       case 'consultations':\r\n         return (\r\n-           \r\n+            return <MesReservations onError={setGlobalError} />;\r\n       case 'humeur':\r\n         return <SuiviHumeur currentUser={currentUser} />;\r\n       case 'profil':\r\n         return (\r\n"
                },
                {
                    "date": 1750178177240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n     switch (activeTab) {\r\n       case 'reservations':\r\n         return <MesReservations onError={setGlobalError} />;\r\n       case 'consultations':\r\n-        return (\r\n+        return \r\n             return <MesReservations onError={setGlobalError} />;\r\n       case 'humeur':\r\n         return <SuiviHumeur currentUser={currentUser} />;\r\n       case 'profil':\r\n"
                },
                {
                    "date": 1750178186006,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n     switch (activeTab) {\r\n       case 'reservations':\r\n         return <MesReservations onError={setGlobalError} />;\r\n       case 'consultations':\r\n-        return  return <MesReservations onError={setGlobalError} />;\r\n+        return  return < />;\r\n       case 'humeur':\r\n         return <SuiviHumeur currentUser={currentUser} />;\r\n       case 'profil':\r\n         return (\r\n"
                },
                {
                    "date": 1750178200999,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n     switch (activeTab) {\r\n       case 'reservations':\r\n         return <MesReservations onError={setGlobalError} />;\r\n       case 'consultations':\r\n-        return  return < />;\r\n+        return  return < Consu/>;\r\n       case 'humeur':\r\n         return <SuiviHumeur currentUser={currentUser} />;\r\n       case 'profil':\r\n         return (\r\n"
                }
            ],
            "date": 1750178163349,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect, useCallback } from 'react';\r\nimport Layout from '../components/commun/Layout';\r\nimport SuiviHumeur from '../components/utilisateur/SuiviHumeur';\r\nimport FormulaireProfil from '../components/utilisateur/FormulaireProfil';\r\nimport MesReservations from '../components/utilisateur/MesReservations';\r\nimport { getProfil, getConsultationsUtilisateur } from '../services/serviceUtilisateur';\r\nimport { CalendarDays, UserCheck, Smile, User, XCircle, ChevronsLeft, ChevronsRight, Moon, Sun } from 'lucide-react';\r\n\r\nconst TableauUtilisateur = () => {\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [consultationsPassees, setConsultationsPassees] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [globalError, setGlobalError] = useState(null);\r\n  const [consultationsError, setConsultationsError] = useState(null);\r\n  const [activeTab, setActiveTab] = useState('reservations');\r\n  const [sidebarReduced, setSidebarReduced] = useState(false);\r\n  const [darkMode, setDarkMode] = useState(() => {\r\n    // Charger le mode sombre dans localStorage si défini, sinon false\r\n    if (typeof window !== \"undefined\") {\r\n      return localStorage.getItem('darkMode') === 'true';\r\n    }\r\n    return false;\r\n  });\r\n\r\n  // Appliquer ou retirer la classe 'dark' sur body\r\n  useEffect(() => {\r\n    if (darkMode) {\r\n      document.documentElement.classList.add('dark');\r\n      localStorage.setItem('darkMode', 'true');\r\n    } else {\r\n      document.documentElement.classList.remove('dark');\r\n      localStorage.setItem('darkMode', 'false');\r\n    }\r\n  }, [darkMode]);\r\n\r\n  useEffect(() => {\r\n    const fetchUserData = async () => {\r\n      try {\r\n        const user = await getProfil();\r\n        if (user?.id && user.role === 'USER') {\r\n          setCurrentUser(user);\r\n          setGlobalError(null);\r\n        } else {\r\n          setCurrentUser(null);\r\n          setGlobalError(\"Accès refusé.\");\r\n        }\r\n      } catch {\r\n        setGlobalError(\"Erreur de connexion.\");\r\n        setCurrentUser(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchUserData();\r\n  }, []);\r\n\r\n  const fetchConsultations = useCallback(async () => {\r\n    if (!currentUser?.id) return;\r\n    try {\r\n      const data = await getConsultationsUtilisateur();\r\n      setConsultationsPassees(data);\r\n    } catch {\r\n      setConsultationsError(\"Erreur lors du chargement.\");\r\n    }\r\n  }, [currentUser]);\r\n\r\n  useEffect(() => {\r\n    if (currentUser?.id) fetchConsultations();\r\n  }, [currentUser, fetchConsultations]);\r\n\r\n  const formatDateTime = (dateString, timeString = '') => {\r\n    try {\r\n      const dt = new Date(`${dateString}T${timeString}`);\r\n      return dt.toLocaleString('fr-FR', {\r\n        year: 'numeric', month: 'long', day: 'numeric',\r\n        hour: timeString ? '2-digit' : undefined,\r\n        minute: timeString ? '2-digit' : undefined\r\n      });\r\n    } catch {\r\n      return dateString;\r\n    }\r\n  };\r\n\r\n  const renderSection = () => {\r\n    switch (activeTab) {\r\n      case 'reservations':\r\n        return <MesReservations onError={setGlobalError} />;\r\n      case 'consultations':\r\n        return (\r\n           \r\n      case 'humeur':\r\n        return <SuiviHumeur currentUser={currentUser} />;\r\n      case 'profil':\r\n        return (\r\n          <div className=\"p-4 max-w-2xl mx-auto\">\r\n            <h2 className=\"text-2xl font-bold mb-4 text-blue-700 dark:text-blue-400 flex items-center gap-2\">\r\n              <User size={24} /> Mes infos personnelles\r\n            </h2>\r\n            <FormulaireProfil />\r\n          </div>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  if (loading) return <Layout><div className=\"text-center p-8 text-blue-600 dark:text-blue-400\">Chargement...</div></Layout>;\r\n  if (globalError && !currentUser) return <Layout><div className=\"p-6 text-red-600 dark:text-red-400\">{globalError}</div></Layout>;\r\n\r\n  return (\r\n    <Layout>\r\n      <div className=\"flex min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300\">\r\n        {/* Sidebar */}\r\n        <nav\r\n          className={`flex flex-col justify-between bg-gradient-to-b from-blue-800 to-blue-600 text-white shadow-lg\r\n            transition-width duration-300 ease-in-out\r\n            ${sidebarReduced ? 'w-20' : 'w-64'}\r\n          `}\r\n        >\r\n          {/* User top section */}\r\n          <div className=\"flex flex-col items-center p-3 border-b border-blue-500 space-y-1\">\r\n            {currentUser?.photoUrl ? (\r\n              <img\r\n                src={currentUser.photoUrl}\r\n                alt=\"user\"\r\n                className=\"w-14 h-14 rounded-full\"\r\n              />\r\n            ) : (\r\n              <div className=\"w-14 h-14 bg-blue-500 rounded-full flex items-center justify-center text-white text-lg font-semibold\">\r\n                {currentUser?.prenom?.[0] || 'U'}\r\n              </div>\r\n            )}\r\n\r\n            {!sidebarReduced && (\r\n              <>\r\n                <div className=\"flex gap-1 font-semibold text-base leading-tight justify-center\">\r\n                  <span>{currentUser?.prenom}</span>\r\n                  <span>{currentUser?.nom}</span>\r\n                </div>\r\n                <span className=\"text-blue-300 text-xs\">Utilisateur</span>\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Navigation items */}\r\n          <div className=\"flex-grow mt-1 space-y-1 px-2\">\r\n            <NavItem\r\n              icon={<UserCheck size={20} />}\r\n              label=\"Réservations\"\r\n              active={activeTab === \"reservations\"}\r\n              onClick={() => setActiveTab(\"reservations\")}\r\n              reduced={sidebarReduced}\r\n            />\r\n            <NavItem\r\n              icon={<CalendarDays size={20} />}\r\n              label=\"Consultations\"\r\n              active={activeTab === \"consultations\"}\r\n              onClick={() => setActiveTab(\"consultations\")}\r\n              reduced={sidebarReduced}\r\n            />\r\n            <NavItem\r\n              icon={<Smile size={20} />}\r\n              label=\"Humeur\"\r\n              active={activeTab === \"humeur\"}\r\n              onClick={() => setActiveTab(\"humeur\")}\r\n              reduced={sidebarReduced}\r\n            />\r\n            <NavItem\r\n              icon={<User size={20} />}\r\n              label=\"Profil\"\r\n              active={activeTab === \"profil\"}\r\n              onClick={() => setActiveTab(\"profil\")}\r\n              reduced={sidebarReduced}\r\n            />\r\n          </div>\r\n\r\n          {/* Mode sombre toggle */}\r\n          <div className=\"flex flex-col items-center gap-1 px-2 mt-2\">\r\n            {!sidebarReduced && (\r\n              <button\r\n                onClick={() => setDarkMode(!darkMode)}\r\n                className=\"flex items-center gap-2 text-blue-200 hover:text-white transition px-4 py-2 rounded w-full justify-center bg-blue-700 dark:bg-blue-900\"\r\n                aria-label=\"Toggle mode sombre\"\r\n              >\r\n                {darkMode ? <Sun size={18} /> : <Moon size={18} />}\r\n                <span>{darkMode ? 'Clair' : 'Sombre'}</span>\r\n              </button>\r\n            )}\r\n            {sidebarReduced && (\r\n              <button\r\n                onClick={() => setDarkMode(!darkMode)}\r\n                className=\"text-blue-200 hover:text-white transition p-2 rounded\"\r\n                aria-label=\"Toggle mode sombre\"\r\n              >\r\n                {darkMode ? <Sun size={20} /> : <Moon size={20} />}\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Toggle button - un peu plus haut */}\r\n          <div className=\"p-1 border-t border-blue-500 flex justify-center mt-2 mb-4\">\r\n            <button\r\n              onClick={() => setSidebarReduced(!sidebarReduced)}\r\n              className=\"text-blue-200 hover:text-white transition-transform duration-200 ease-in-out\"\r\n              aria-label={sidebarReduced ? \"Ouvrir sidebar\" : \"Réduire sidebar\"}\r\n              style={{ transformOrigin: \"center\" }}\r\n            >\r\n              {sidebarReduced ? <ChevronsRight size={24} /> : <ChevronsLeft size={24} />}\r\n            </button>\r\n          </div>\r\n        </nav>\r\n\r\n        {/* Main content */}\r\n        <main className=\"flex-grow p-6 text-gray-900 dark:text-gray-100 transition-colors duration-300\">\r\n          {globalError && (\r\n            <div className=\"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-400 px-4 py-2 rounded flex items-center gap-2 mb-4\">\r\n              <XCircle size={20} />\r\n              <span>{globalError}</span>\r\n            </div>\r\n          )}\r\n          {renderSection()}\r\n        </main>\r\n      </div>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nconst NavItem = ({ icon, label, active, onClick, reduced }) => (\r\n  <button\r\n    onClick={onClick}\r\n    className={`w-full flex items-center gap-3 px-4 py-2 rounded-lg transition-all duration-200 \r\n      ${active ? 'bg-blue-900 dark:bg-blue-700' : 'hover:bg-blue-700 dark:hover:bg-blue-800'} ${reduced ? 'justify-center' : ''}`}\r\n  >\r\n    {icon}\r\n    {!reduced && <span>{label}</span>}\r\n  </button>\r\n);\r\n\r\nexport default TableauUtilisateur;\r\n"
        }
    ]
}